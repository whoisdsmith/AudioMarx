"use strict";var e=require("obsidian");function t(e,t,i,s){return new(i||(i=Promise))((function(o,n){function l(e){try{r(s.next(e))}catch(e){n(e)}}function a(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((s=s.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const i="alphabetical",s="ctime",o="mtime",n="type",l="extension",a=e=>{switch(e){case i:return"Abc";case s:return"Created";case o:return"Modified";case n:return"Type";case l:return"Ext";default:return""}};var r;!function(e){e.RECENTS="recents",e.FILES="files",e.UNTAGGED="untagged",e.DAILIES="dailies"}(r||(r={}));const d=e=>Object.keys(r).map((e=>e.toLowerCase())).contains(e);var c;!function(e){e.TAG_GROUP="tag_group",e.PROPERTY_GROUP="property_group",e.FOLDER_GROUP="folder_group"}(c||(c={}));const u=e=>d(e)||(e=>Object.keys(c).map((e=>e.toLowerCase())).contains(e))(e),h=new Set([r.DAILIES,r.RECENTS,r.FILES]),p=t=>e.Platform.isDesktop||h.has(t),g=(e,t)=>{var i,s,o,n;switch(e.groupType){case c.TAG_GROUP:{const t="\\.\\.\\./(.*)/\\.\\.\\.";return null!==(o=(null!==(s=null===(i=e.groupName.match(t))||void 0===i?void 0:i.at(1))&&void 0!==s?s:e.groupName).split("/").last())&&void 0!==o?o:""}case c.FOLDER_GROUP:return"/"===e.groupName?t:null!==(n=e.groupName.split("/").last())&&void 0!==n?n:e.groupName;default:return e.groupName}},v="quietly",m="open",C="copy",f={0:e=>{e&&(e.version=1)},1:e=>{const t=e;t&&(t.vaultVisible=!0,t.clockVisible=!1,t.rxSeparatorVisible=!0,t.otcSeparatorVisible=!0,t.version=2)},2:e=>{const t=e;t&&(t.rxGroups.forEach((e=>{e.logsFolderVisible=[r.DAILIES,r.FILES,r.RECENTS].contains(e.groupName),e.templatesFolderVisible=[r.FILES,r.RECENTS].contains(e.groupName),e.excludedFolders=[]})),t.tagGroups.forEach((e=>{e.logsFolderVisible=!1,e.templatesFolderVisible=!1,e.excludedFolders=[]})),t.version=3)},3:e=>{const t=e;t&&(t.rxGroups.forEach((e=>{e.isPinned=!1})),t.otcGroups=t.tagGroups.map((e=>{var t,s,o,n,l,a,r;return{groupName:e.tag,collapsedFolders:null!==(t=e.collapsedFolders)&&void 0!==t?t:[],isPinned:null!==(s=e.isPinned)&&void 0!==s&&s,isVisible:!0,sortMethod:null!==(o=e.sortMethod)&&void 0!==o?o:i,sortAscending:null===(n=e.sortAscending)||void 0===n||n,excludedFolders:null!==(l=e.excludedFolders)&&void 0!==l?l:[],templatesFolderVisible:null!==(a=e.templatesFolderVisible)&&void 0!==a&&a,logsFolderVisible:null!==(r=e.logsFolderVisible)&&void 0!==r&&r}})),t.tagGroups=[],t.version=4)},4:e=>{const t=e;t&&(t.rxGroups.filter((e=>d(e.groupName))).map((e=>(e.groupType=e.groupName,e.groupName="",e))),t.otcGroups.forEach((e=>{e.groupType=c.TAG_GROUP})),t.version=5)},5:e=>{e&&(e.version=6)},6:e=>{e&&(e.version=7)}},b={version:3,avatarVisible:!0,vaultVisible:!0,clockVisible:!1,rxSeparatorVisible:!0,otcSeparatorVisible:!0,recentsCount:10,postLogAction:v,tagGroups:[],loggingPath:"",avatarPath:"",rxGroups:[{groupName:r.DAILIES,collapsedFolders:[],isVisible:!0,sortMethod:i,sortAscending:!0,logsFolderVisible:!0,templatesFolderVisible:!1,excludedFolders:[]},{groupName:r.FILES,collapsedFolders:[],isVisible:!0,sortMethod:n,sortAscending:!0,logsFolderVisible:!0,templatesFolderVisible:!0,excludedFolders:[]},{groupName:r.RECENTS,collapsedFolders:[],isVisible:!0,sortMethod:i,sortAscending:!0,logsFolderVisible:!0,templatesFolderVisible:!0,excludedFolders:[]},{groupName:r.UNTAGGED,collapsedFolders:[],isVisible:!0,sortMethod:i,sortAscending:!0,logsFolderVisible:!1,templatesFolderVisible:!1,excludedFolders:[]}],dailiesTag:"daily"},y=(e,t,i)=>[...e.otcGroups,...e.rxGroups].find((e=>e.groupType===t&&e.groupName===i));var F;!function(e){e.image="image",e.audio="audio",e.video="video",e.md="md",e.canvas="canvas",e.code="code",e.html="html",e.archive="archive",e.text="text"}(F||(F={}));const T="image",w="file-image",S="file-audio",E="file-video",k="file-type",x="file-json-2",I="folder-archive",P=new Map([["bmp",{type:F.image,icon:T}],["gif",{type:F.image,icon:T}],["heic",{type:F.image,icon:T}],["jpeg",{type:F.image,icon:T}],["jpg",{type:F.image,icon:T}],["png",{type:F.image,icon:T}],["svg",{type:F.image,icon:T}],["tiff",{type:F.image,icon:T}],["webp",{type:F.image,icon:T}],["obj",{type:F.image,icon:w}],["procreate",{type:F.image,icon:w}],["psd",{type:F.image,icon:w}],["usdz",{type:F.image,icon:w}],["xcf",{type:F.image,icon:w}],["3gp",{type:F.audio,icon:S}],["flac",{type:F.audio,icon:S}],["m4a",{type:F.audio,icon:S}],["mp3",{type:F.audio,icon:S}],["oga",{type:F.audio,icon:S}],["ogg",{type:F.audio,icon:S}],["opus",{type:F.audio,icon:S}],["wav",{type:F.audio,icon:S}],["avi",{type:F.video,icon:E}],["hevc",{type:F.video,icon:E}],["mkv",{type:F.video,icon:E}],["mov",{type:F.video,icon:E}],["mp4",{type:F.video,icon:E}],["mpeg",{type:F.video,icon:E}],["mpg",{type:F.video,icon:E}],["ogv",{type:F.video,icon:E}],["webm",{type:F.video,icon:E}],["docx",{type:F.text,icon:k}],["pdf",{type:F.text,icon:k}],["rtf",{type:F.text,icon:k}],["txt",{type:F.text,icon:k}],["md",{type:F.md,icon:"file-text"}],["canvas",{type:F.canvas,icon:"layout-dashboard"}],["css",{type:F.code,icon:x}],["js",{type:F.code,icon:x}],["json",{type:F.code,icon:x}],["ts",{type:F.code,icon:x}],["html",{type:F.html,icon:"file-code"}],["7z",{type:F.archive,icon:I}],["apk",{type:F.archive,icon:I}],["dmg",{type:F.archive,icon:I}],["gz",{type:F.archive,icon:I}],["iso",{type:F.archive,icon:I}],["jar",{type:F.archive,icon:I}],["rar",{type:F.archive,icon:I}],["tar",{type:F.archive,icon:I}],["war",{type:F.archive,icon:I}],["wim",{type:F.archive,icon:I}],["xar",{type:F.archive,icon:I}],["xz",{type:F.archive,icon:I}],["zip",{type:F.archive,icon:I}],["zipx",{type:F.archive,icon:I}]]),D=e=>{var t;return null===(t=P.get(e))||void 0===t?void 0:t.type};function G(e,t){var i,s;return!!(null===(s=null===(i=e.internalPlugins.plugins.bookmarks.instance)||void 0===i?void 0:i.items)||void 0===s?void 0:s.find((e=>"file"===e.type&&e.path===t.path)))}const N=(t,i,s)=>{var o,n;const l=null!==(o=null!=s?s:t.metadataCache.getFileCache(i))&&void 0!==o?o:void 0;return{file:i,maybeMetadata:l,mtime:i.stat.mtime,ctime:i.stat.ctime,path:i.path,basename:i.basename,extension:i.extension,tags:null!==(n=l?e.getAllTags(l):[])&&void 0!==n?n:[],isBookmarked:G(t,i)}},A="collapsed";class M{constructor(e,t,i,s,o,n,l){var a;this.app=e,this.groupName=t,this.folderPath=i,this.folderName=null!==(a=i.split("/").last())&&void 0!==a?a:"",this.showStatusIcon=o,this.sortedFiles=[],this.sortedSubFolders=[],this.collapseChangedCallback=s,this.getGroupIconCallback=n,this.getEmptyMessageCallback=l,this.rootElement=document.createElement("div"),this.rootElement.addClass("folder-holder")}hasFileWithin(e){return this.sortedFiles.contains(e)||this.sortedSubFolders.some((t=>t.hasFileWithin(e)))}getOpenFolders(){const e=this.isCollapsed()?[]:[this.folderPath],t=this.sortedSubFolders.flatMap((e=>e.getOpenFolders()));return e.concat(t)}rebuild(e,t,i){this.rootElement.empty(),this.build(e,t,i,0)}buildTitle(t,i){this.titleContainer=document.createElement("div"),this.titleContainer.addClass("family-title"),this.titleContainer.style.marginLeft=`-${12+17*i}px`,this.titleContainer.style.paddingLeft=16+17*i+"px",this.titleContainer.setAttribute("familyName",this.folderName),this.titleContainer.setAttribute("tag-group-tag",this.groupName);const s=document.createElement("div");s.addClass("family-title-text"),s.setText(this.folderName);const o=document.createElement("div");new e.ExtraButtonComponent(o).setIcon(this.getGroupIconCallback(t)).extraSettingsEl.addClass("child-folder-icon"),this.titleContainer.appendChild(o),this.titleContainer.appendChild(s),this.titleContainer.addEventListener("click",(()=>{this.toggleCollapse(),o.empty(),new e.ExtraButtonComponent(o).setIcon(this.getGroupIconCallback(this.isCollapsed())).extraSettingsEl.addClass("child-folder-icon")}))}build(e,t,i,s){const o=!e.contains(this.folderPath);this.buildTitle(o,s-1),this.rootElement.appendChild(this.titleContainer),this.buildContent(e,t,i,s),this.rootElement.appendChild(this.contentContainer),o&&this.setCollapsed(!0,!1)}buildContent(e,t,i,s){if(this.contentContainer=document.createElement("div"),this.contentContainer.addClass("family-content"),0===this.sortedSubFolders.length&&0===this.sortedFiles.length){const e=document.createElement("div");e.addClass("empty-rx-message"),e.setText(this.getEmptyMessageCallback()),this.contentContainer.appendChild(e)}else this.sortedSubFolders.forEach((o=>{o.build(e,t,i,s+1),this.contentContainer.appendChild(o.rootElement)})),this.sortedFiles.forEach((e=>{this.contentContainer.appendChild(this.buildFileElement(e,t,i,s))}))}sortFilesByName(e,t){const i=e.name.toLowerCase(),s=t.name.toLowerCase();return i<s?-1:i>s?1:0}sortFilesByBookmark(e,t){const i=G(this.app,e),s=G(this.app,t);return i&&!s?-1:!i&&s?1:0}buildFileElement(t,i,s,o){var n,l,a,r;const d=this.app.metadataCache.getFileCache(t),c=null==d?void 0:d.frontmatter,u=`${t.path}\n\nLast modified at ${window.moment(t.stat.mtime).format("YYYY-MM-DD HH:mm")}\nCreated at ${window.moment(t.stat.ctime).format("YYYY-MM-DD HH:mm")}`,h=document.createElement("div");h.addClass("child-item"),h.style.marginLeft=`-${12+17*o}px`,h.style.paddingLeft=16+17*o+"px",h.addEventListener("click",(e=>{i(t,e.metaKey||e.ctrlKey)}));const p=document.createElement("div");p.addClass("status-icon"),e.setIcon(p,"circle"),this.showStatusIcon&&d&&0===(null!==(l=null===(n=e.getAllTags(d))||void 0===n?void 0:n.length)&&void 0!==l?l:-1)&&"md"===t.extension&&(p.addClass("visible"),p.ariaLabel="Untagged"),h.appendChild(p),new e.ExtraButtonComponent(h).setIcon(null!==(a=null==c?void 0:c.icon)&&void 0!==a?a:(e=>{var t,i;return null!==(i=null===(t=P.get(e.extension))||void 0===t?void 0:t.icon)&&void 0!==i?i:"file-question"})(t)).setDisabled(!0).extraSettingsEl.addClass("child-item-icon");const g=document.createElement("div");g.addClass("child-item-text"),g.setText(null!==(r=(null==c?void 0:c.alias)||(null==c?void 0:c.aliases))&&void 0!==r?r:t.basename),g.ariaLabel=u,h.appendChild(g);const v=document.createElement("div");if(v.addClass("bookmark-icon"),G(this.app,t)&&(e.setIcon(v,"bookmark"),v.ariaLabel="Bookmarked"),h.appendChild(v),"md"!==t.extension.toLowerCase()){const e=document.createElement("div");e.addClass("nav-file-tag"),e.setText(t.extension.toUpperCase()),h.appendChild(e)}return h.setAttribute("data-path",t.path),s(t,h),h}setCollapsed(e,t){const i=e!==this.isCollapsed();e?(this.titleContainer.addClass(A),this.contentContainer.addClass(A)):(this.titleContainer.removeClass(A),this.contentContainer.removeClass(A)),i&&this.collapseChangedCallback(t)}isCollapsed(){return!(!this.titleContainer||!this.contentContainer)&&(this.titleContainer.hasClass(A)!==this.contentContainer.hasClass(A)&&console.warn("Title and content collapse states are out of sync!"),this.titleContainer.hasClass(A))}toggleCollapse(){this.setCollapsed(!this.isCollapsed(),!0)}addFileToFolder(e,t,i){if(0===t.length)return void this.sortedFiles.push(e);const s=t.split("/"),o=`${i}/${s[0]}`;let n=this.sortedSubFolders.find((e=>e.folderPath===o));n||(n=new M(this.app,this.groupName,o,this.collapseChangedCallback,this.showStatusIcon,this.getGroupIconCallback,this.getEmptyMessageCallback),this.sortedSubFolders.push(n)),n&&n.addFileToFolder(e,s.slice(1).join("/"),o)}}class R extends e.SuggestModal{constructor(i,s,o){super(i),this.scope.register(["Shift"],"Enter",(i=>t(this,void 0,void 0,(function*(){yield this.onChooseSuggestion({folderName:e.normalizePath(this.inputEl.value),isCreator:!0},i),this.close()})))),this.onSelect=o,this.setPlaceholder("Type a folder"),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"shift ↵",purpose:"to create"},{command:"esc",purpose:"to dismiss"}]),this.allFolders=this.app.vault.getAllLoadedFiles().filter((t=>t instanceof e.TFolder&&!s.contains(t.path))).map((e=>e.path))}getSuggestions(e){const t=this.allFolders.filter((t=>t.toLowerCase().includes(e.toLowerCase()))).sort(((t,i)=>t===e?-1:i===e?1:t<i?-1:i<t?1:0)).map((e=>({folderName:e,isCreator:!1})));return 0===t.length?[{folderName:e,isCreator:!0}]:t}renderSuggestion(e,t){e.isCreator&&e.folderName?t.createEl("div",{text:`Create "${e.folderName}" ...`}):t.createEl("div",{text:e.folderName})}onChooseSuggestion(i,s){return t(this,void 0,void 0,(function*(){if(s.shiftKey||i.isCreator){const t=this.app.vault.getAbstractFileByPath(i.folderName);if(t){if(t instanceof e.TFile)return void new e.Notice(`Path ${i.folderName} already exists as a file. Please choose a different path.`)}else yield this.app.vault.createFolder(i.folderName),new e.Notice(`Created folder at "${i.folderName}"`)}new e.Notice(`Selected "${i.folderName}"`),this.onSelect(i.folderName)}))}}class L extends M{constructor(e,t,i,s,o,n,l,a,r,d){super(e,t,"/",(e=>{if(!e)return;const s=y(this.settings,i,t);return s?(s.openFolders=this.getOpenFolders(),d.saveSettingsCallback()):void 0}),s,d.getGroupIconCallback,(()=>this.getEmptyMessage())),u(i)||console.warn(`Unknown group type ${i} with name ${t}. Continuing...`),this.settings=o,this.groupType=i,this.isMovable=n,this.canCollapseInnerFolders=l,this.canBePinned=a,this.isPinned=r,this.callbacks=d}addFileToFolder(e,t,i){const s=N(this.app,e);this.renderedFileCaches.push({file:e,state:s}),super.addFileToFolder(e,t,i)}getGroupSettings(){return y(this.settings,this.groupType,this.groupName)}isVisible(){var e,t;return null===(t=null===(e=this.getGroupSettings())||void 0===e?void 0:e.isVisible)||void 0===t||t}requestRender(){this.callbacks.requestRenderCallback&&this.callbacks.requestRenderCallback()}addSortOptionsToMenu(e,i){const s=e=>t(this,void 0,void 0,(function*(){const t=this.getGroupSettings();void 0!==t&&(t.sortMethod===e?t.sortAscending=!t.sortAscending:(t.sortMethod=e,t.sortAscending=!0),yield this.callbacks.saveSettingsCallback(),this.requestRender())})),o=(e,t)=>{var i,o;e.onClick((()=>s(t))),t===(null===(i=this.getGroupSettings())||void 0===i?void 0:i.sortMethod)?(e.iconEl.addClass("untagged-sort-confirmation"),e.setIcon((null===(o=this.getGroupSettings())||void 0===o?void 0:o.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail")):e.setIcon("down-arrow-with-tail")};i.forEach((t=>{e.addItem((e=>{e.setTitle(a(t)),o(e,t)}))}))}shouldRenderBasedOnSortMethodSetting(e,t){const a=this.getGroupSettings();switch(null==a?void 0:a.sortMethod){case i:return e.basename!==t.basename;case s:return e.ctime!==t.ctime;case o:{const i=(null==a?void 0:a.sortAscending)?this.sortedFiles.last():this.sortedFiles.first();return e.mtime!==t.mtime&&i!==t.file}case l:case n:return e.extension!==t.extension}return!1}buildDateFileStructure(t,i,s){t.sort(((t,o)=>{const n=s?t.stat.ctime:t.stat.mtime,l=s?o.stat.ctime:o.stat.mtime,a=e.moment(n).format("YYYY-MM"),r=e.moment(l).format("YYYY-MM");if(a<r)return i?1:-1;if(a>r)return i?-1:1;const d=this.sortFilesByBookmark(t,o);return 0!=d?d:(i?1:-1)*(l-n)})).forEach((t=>{if(null===this.app.metadataCache.getFileCache(t))return void console.error("Cache is null after filtering files. This shouldn't happen.");const i=s?t.stat.ctime:t.stat.mtime,o=e.moment(i),n=o.format("YYYY"),l=o.format("MM");this.addFileToFolder(t,`${n}/${l}`,"/")}))}getContextMenu(){const i=new e.Menu;this.isMovable&&(i.addItem((e=>e.setTitle("Move up").setIcon("arrow-up").setSection("movement").onClick((()=>{this.callbacks.moveCallback(!0)})))),i.addItem((e=>e.setTitle("Move down").setIcon("arrow-down").setSection("movement").onClick((()=>{this.callbacks.moveCallback(!1)}))))),this.canBePinned&&i.addItem((e=>e.setTitle(this.isPinned?"Unpin":"Pin").setIcon(this.isPinned?"pin-off":"pin").setSection("movement").onClick((()=>{this.callbacks.pinCallback&&this.callbacks.pinCallback(!this.isPinned)})))),this.canCollapseInnerFolders&&i.addItem((e=>e.setTitle("Collapse inner folders").setIcon("chevrons-down-up").setSection("collapsing").onClick((()=>{this.collapseInnerFolders()}))));const s=this.getGroupSettings();return i.addItem((e=>{e.setTitle("Folder exclusions").setSection("exclusions").setIcon("folder-x");const i=e.setSubmenu();i.addItem((e=>{e.setTitle(((null==s?void 0:s.templatesFolderVisible)?"Hide":"Show")+" templates").setIcon((null==s?void 0:s.templatesFolderVisible)?"eye-off":"eye").setSection("hide").onClick((()=>t(this,void 0,void 0,(function*(){s?(s.templatesFolderVisible=!s.templatesFolderVisible,yield this.callbacks.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to get group setting for ${this.groupName}`)}))))})),i.addItem((e=>{e.setTitle(((null==s?void 0:s.logsFolderVisible)?"Hide":"Show")+" logs").setIcon((null==s?void 0:s.logsFolderVisible)?"eye-off":"eye").setSection("hide").onClick((()=>t(this,void 0,void 0,(function*(){s?(s.logsFolderVisible=!s.logsFolderVisible,yield this.callbacks.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to get group setting for ${this.groupName}`)}))))})),null==s||s.excludedFolders.forEach((e=>{i.addItem((i=>{i.setTitle(`Include ${e}`).setIcon("folder-plus").setSection("include").onClick((()=>t(this,void 0,void 0,(function*(){s?(s.excludedFolders.remove(e),yield this.callbacks.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to get group setting for ${this.groupName}`)}))))}))})),i.addItem((e=>{e.setTitle("Exclude folder").setIcon("folder-x").setSection("exclude").onClick((()=>{var e;new R(this.app,["/"].concat(null!==(e=null==s?void 0:s.excludedFolders)&&void 0!==e?e:[]),(e=>t(this,void 0,void 0,(function*(){(null==s?void 0:s.excludedFolders.contains(e))||(null==s||s.excludedFolders.push(e),yield this.callbacks.saveSettingsCallback(),this.requestRender())})))).open()}))}))})),i.addItem((e=>e.setTitle(this.getHideText()).setIcon(this.getHideIcon()).setSection("danger").onClick((()=>{this.callbacks.hideCallback()})).setWarning(!0))),i}expandAll(e){this.setInnerFoldersCollapsed(!1,e),this.setCollapsed(!1,e)}setInnerFoldersCollapsed(e,t){this.sortedSubFolders.forEach((i=>i.setCollapsed(e,t)))}collapseInnerFolders(){this.setInnerFoldersCollapsed(!0,!0)}buildPinContainer(){const t=document.createElement("div");return t.addClass("pin"),this.isPinned&&t.addClass("is-pinned"),e.setIcon(t,"chevrons-down"),t}buildTitleSvgHolder(){const t=document.createElement("div");return e.setIcon(t,"chevron-down"),t.addClass("title-chevron"),this.isPinned&&t.addClass("is-pinned"),t.addEventListener("click",(()=>{this.toggleCollapse()})),t.appendChild(this.buildPinContainer()),t}buildTitleTextDiv(t){const i=document.createElement("div");i.addClass("text-label");const s=document.createElement("div");e.setIcon(s,this.getTextIcon(t)),s.addClass("text-icon"),s.ariaLabel=this.getTextIconTooltip();const o=document.createElement("div");return o.addClass("title-text"),o.appendChild(s),o.appendChild(i),o.addEventListener("click",(()=>{this.toggleCollapse()})),i.setText(this.getTitleText().toUpperCase()),i.addEventListener("contextmenu",(e=>{const t=this.getContextMenu();t&&t.showAtMouseEvent(e)})),i.ariaLabel=this.getTitleTooltip(),o}buildPill(){const t=document.createElement("div");t.addClass("title-tag");const i=document.createElement("div");i.addClass("tag-parts-container");const s=this.getPillIcon();s&&e.setIcon(i,s);const o=document.createElement("div");o.addClass("tag-label"),o.setText(this.getPillText()),i.appendChild(o);const n=this.getPillTooltipText();n.length>0&&(i.ariaLabel=n);const l=this.getPillClickHandler();return l||i.addClass("wiggle"),i.addEventListener("click",(e=>{e.stopPropagation(),l&&l(e)})),t.appendChild(i),t}buildTitle(e){""!==this.folderName&&console.warn(`Unexpected folder name ${this.folderName}`),this.titleContainer=document.createElement("div"),this.titleContainer.addClass("title-container"),this.titleContainer.appendChild(this.buildTitleSvgHolder()),this.titleContainer.appendChild(this.buildTitleTextDiv(e)),this.titleContainer.appendChild(this.buildPill())}rebuildFileStructure(e){this.sortedFiles=[],this.sortedSubFolders=[],this.renderedFileCaches=[],this.buildFileStructure(e)}highlightFile(e){Array.from(document.getElementsByClassName("child-item")).forEach((t=>{t.getAttribute("data-path")===e.path?t.addClass("active"):t.removeClass("active")}))}frontmattersEqual(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;const i=Object.keys(e),s=Object.keys(t);return i.length===s.length&&!i.some((i=>"position"!==i&&t[i]!==e[i]))}tagsEqual(e,t){return e.length===t.length&&!e.some((e=>!t.contains(e)))}isFileExcluded(e,t){if(!e.parent)return!1;let i=!1;return e.parent.path.split("/").reduce(((e,s)=>{if(i)return"";const o=0===e.length?s:e+"/"+s;return t.contains(o)?(i=!0,""):o}),""),i}shouldFileCauseRender(e,t){var i,s,o;const n=t.contains(e.path),l=this.renderedFileCaches.find((t=>t.file===e.file));if(!l&&!n)return this.wouldBeRendered(e);const a=t.contains(null!==(i=null==l?void 0:l.file.path)&&void 0!==i?i:"");if(n&&(!a||l))return!0;if(!l||n)return!1;if(l.state.basename!==e.basename)return!0;if(l.state.isBookmarked!==e.isBookmarked)return!0;const r=null===(s=l.state.maybeMetadata)||void 0===s?void 0:s.frontmatter,d=null===(o=e.maybeMetadata)||void 0===o?void 0:o.frontmatter;if(!this.frontmattersEqual(r,d))return!0;const c=l.state.tags,u=e.tags;return!this.tagsEqual(c,u)||this.shouldRender(l.state,e)}getTemplatesFolders(){var e,t,i,s,o,n,l;const a=[],r=null!==(s=null===(i=null===(t=null===(e=this.app.internalPlugins.plugins.templates)||void 0===e?void 0:e.instance)||void 0===t?void 0:t.options)||void 0===i?void 0:i.folder)&&void 0!==s?s:"";""!==r&&a.push(r);const d=null!==(l=null===(n=null===(o=this.app.plugins.plugins["templater-obsidian"])||void 0===o?void 0:o.settings)||void 0===n?void 0:n.templates_folder)&&void 0!==l?l:"";return""!==d&&a.push(d),a}render(e,t,i){var s,o;const n=null!==(s=i.openFolders)&&void 0!==s?s:[],l=[...null!==(o=i.excludedFolders)&&void 0!==o?o:[]];i.templatesFolderVisible||l.push(...this.getTemplatesFolders()),!i.logsFolderVisible&&this.settings&&this.settings.loggingPath&&l.push(this.settings.loggingPath),!t&&e.length>0&&!e.some((e=>this.shouldFileCauseRender(e,l)))||(this.rebuildFileStructure(l),this.isVisible()?this.rootElement.removeClass("hidden"):this.rootElement.addClass("hidden"),super.rebuild(n,this.callbacks.fileClickCallback,this.callbacks.fileAddedCallback),this.rootElement.setAttribute("group-name",this.groupName),this.rootElement.setAttribute("tag-group-tag",this.groupName),this.rootElement.addClass(this.getContainerClass()),this.contentContainer.removeClass("family-content"),this.contentContainer.addClass("content"))}}class V extends L{constructor(e,t,i,s,o,n,l){super(e,o,s,l,t,!1,!0,!0,n,i)}getHideText(){return"Remove"}getHideIcon(){return"trash"}isVisible(){return!0}getPillText(){var e,t;return a(null!==(t=null===(e=this.getGroupSettings())||void 0===e?void 0:e.sortMethod)&&void 0!==t?t:i)}getPillTooltipText(){return"Sort"}getPillIcon(){var e,t;return null===(t=null===(e=this.getGroupSettings())||void 0===e?void 0:e.sortAscending)||void 0===t||t?"down-arrow-with-tail":"up-arrow-with-tail"}getContainerClass(){return"otc-child"}getFileSortingFn(e){switch(e){case o:return(e,t)=>e.stat.mtime-t.stat.mtime;case s:return(e,t)=>e.stat.ctime-t.stat.ctime;default:return(e,t)=>e.name<t.name?-1:e.name>t.name?1:0}}getEmptyMessage(){return""}shouldRender(e,t){return this.shouldRenderBasedOnSortMethodSetting(e,t)}}class O extends V{constructor(e,t,i,s,o){super(e,i,o,c.TAG_GROUP,t,s,!1)}wouldBeRendered(t){var i,s,o,n,l;if(!t.maybeMetadata)return!1;const a=null===(i=this.getIsolatedTagMatch())||void 0===i?void 0:i.at(1);return(null!==(l=null===(n=null===(o=null===(s=e.getAllTags(t.maybeMetadata))||void 0===s?void 0:s.map((e=>e.replace("#",""))))||void 0===o?void 0:o.unique())||void 0===n?void 0:n.filter((e=>{if(a)return e.contains(a);{const t=this.groupName.split("/").length;return e.split("/").slice(0,t).join("/")===this.groupName}})).length)&&void 0!==l?l:0)>0}getIsolatedTagMatch(){return this.groupName.match("\\.\\.\\./(.*)/\\.\\.\\.")}getTitleText(){var e;const t=this.getIsolatedTagMatch();return t?`${t[1]}`:null!==(e=this.groupName.split("/").last())&&void 0!==e?e:""}getTextIcon(){return this.getIsolatedTagMatch()?"tags":"hash"}getTextIconTooltip(){return this.getIsolatedTagMatch()?"Nested within multiple tags":""}getTitleTooltip(){return this.getIsolatedTagMatch()?"Associated tags:\n\n"+Object.keys(this.getAllAssociatedTags([])).sort().map((e=>`#${e}`)).join("\n"):`#${this.groupName}`}getFileTags(t,i,s){var o,n,l;if(this.isFileExcluded(t,i))return null;const a=this.app.metadataCache.getFileCache(t);if(null===a)return null;const r=null===(l=null===(n=null===(o=e.getAllTags(a))||void 0===o?void 0:o.map((e=>e.replace("#",""))))||void 0===n?void 0:n.unique())||void 0===l?void 0:l.filter((e=>{if(s)return e.contains(s);{const t=this.groupName.split("/").length;return e.split("/").slice(0,t).join("/")===this.groupName}}));return(null==r?void 0:r.length)?{file:t,tags:r}:null}getAllAssociatedTags(e){var t;const i=null===(t=this.getIsolatedTagMatch())||void 0===t?void 0:t.at(1);return this.renderedFileTags=this.app.vault.getMarkdownFiles().map((t=>this.getFileTags(t,e,i))).filter((e=>null!==e)),this.renderedFileTags.reduce(((e,t)=>(t.tags.forEach((i=>{Object.keys(e).contains(i)||(e[i]=[]),e[i].push(t.file)})),e)),{})}getPillClickHandler(){return t=>{const n=new e.Menu;this.addSortOptionsToMenu(n,[i,s,o]),n.showAtMouseEvent(t)}}buildFileStructure(e){var t,s,o,n,l;this.renderedFileTags=[];const a=this.getAllAssociatedTags(e),r=null===(t=this.getIsolatedTagMatch())||void 0===t?void 0:t.at(1),d=null===(o=null===(s=this.getGroupSettings())||void 0===s?void 0:s.sortAscending)||void 0===o||o,c=null!==(l=null===(n=this.getGroupSettings())||void 0===n?void 0:n.sortMethod)&&void 0!==l?l:i,u=this.getFileSortingFn(c);Object.keys(a).sort(((e,t)=>(c===i?d?1:-1:1)*(e<t?-1:e>t?1:0))).forEach((e=>{const t=e.replace(this.groupName,"");a[e].sort(((e,t)=>{const i=this.sortFilesByBookmark(e,t);return 0!=i?i:(d?1:-1)*u(e,t)})).forEach((e=>{var i;let s=t.startsWith("/")?t.slice(1):t;r&&(s.endsWith(r)?s=s.replace(r,""):s.contains(r)&&(s=null!==(i=s.split("/").last())&&void 0!==i?i:"")),this.addFileToFolder(e,s.startsWith("/")?s.slice(1):s,"/")}))}))}}class B extends e.FuzzySuggestModal{constructor(e,t,i){super(e),this.onSelect=i,this.excludedTags=t}getItems(){const e=Object.keys(this.app.metadataCache.getTags()),t=new Set;return e.forEach((i=>{i.split("/").forEach((i=>{if(e.contains(i))return;i.startsWith("#")&&(i=i.substring(1));const s=`.../${i}/...`;this.excludedTags.contains(s)||t.add(s)}))})),e.filter((e=>!this.excludedTags.contains(e.substring(1)))).concat(Array.from(t))}getItemText(e){return e}onChooseItem(t,i){new e.Notice(`Selected ${t}`);const s=t.startsWith("#")?t.substring(1):t;this.onSelect(s)}}class $ extends L{constructor(e,t,i,s,o,n){super(e,"",s,o,t,!0,n,!1,!1,i)}getHideText(){return"Hide"}getHideIcon(){return"eye-off"}getTextIconTooltip(){return""}getContainerClass(){return"rx-child"}}class q extends ${constructor(e,t,i){super(e,t,i,r.DAILIES,!1,!0),this.fileEntryDates=[]}shouldRender(e,t){var i,s;return this.getDailyDate(e.ctime,!0,null===(i=e.maybeMetadata)||void 0===i?void 0:i.frontmatter)!==this.getDailyDate(t.ctime,!0,null===(s=t.maybeMetadata)||void 0===s?void 0:s.frontmatter)}wouldBeRendered(e){return e.tags.contains("#"+this.settings.dailiesTag)}getEmptyMessage(){return`No documents tagged #${this.settings.dailiesTag};`}getTextIcon(){return"calendar-days"}getTitleText(){return"Daily Notes"}getPillText(){return"#"+this.settings.dailiesTag}getPillTooltipText(){return"Change default tag associated with dailies"}getPillIcon(){return""}getTitleTooltip(){return`Shows notes that are tagged with #${this.settings.dailiesTag}`}getPillClickHandler(){return i=>{const s=new e.Menu;s.addItem((i=>{i.setTitle("Change daily tag"),i.setIcon("replace"),i.onClick((()=>{new B(this.app,[],(i=>t(this,void 0,void 0,(function*(){i?(this.settings.dailiesTag=i,yield this.callbacks.saveSettingsCallback(),this.requestRender()):new e.Notice("Not setting dailies tag")})))).open()}))})),s.showAtMouseEvent(i)}}shouldIncludeFile(t,i){var s,o;if(this.isFileExcluded(t,i))return!1;const n=this.app.metadataCache.getFileCache(t);return null!==n&&(null!==(o=null===(s=e.getAllTags(n))||void 0===s?void 0:s.contains("#"+this.settings.dailiesTag))&&void 0!==o&&o)}getDailyDate(t,i,s){var o,n;return e.moment(null!==(n=null!==(o=null==s?void 0:s.day)&&void 0!==o?o:null==s?void 0:s.created)&&void 0!==n?n:t).format(i?"YYYY-MM-DD":"YYYY-MM")}buildFileStructure(t){this.fileEntryDates=[],this.app.vault.getFiles().filter((e=>this.shouldIncludeFile(e,t))).sort(((e,t)=>{const i=this.app.metadataCache.getFileCache(e),s=this.app.metadataCache.getFileCache(t),o=this.getDailyDate(e.stat.ctime,!1,null==i?void 0:i.frontmatter),n=this.getDailyDate(t.stat.ctime,!1,null==s?void 0:s.frontmatter);if(o>n)return-1;if(o<n)return 1;const l=this.sortFilesByBookmark(e,t);if(0!=l)return l;const a=this.getDailyDate(e.stat.ctime,!0,null==i?void 0:i.frontmatter),r=this.getDailyDate(t.stat.ctime,!0,null==s?void 0:s.frontmatter);return a>r?-1:a<r?1:0})).forEach((t=>{const i=this.app.metadataCache.getFileCache(t),s=this.getDailyDate(t.stat.ctime,!0,null==i?void 0:i.frontmatter);this.fileEntryDates.push({file:t,date:s});const o=e.moment(s),n=o.format("YYYY"),l=o.format("MM");this.addFileToFolder(t,`${n}/${l}`,"/")}))}}const Y=[5,10,15];class U extends ${constructor(e,t,i){super(e,t,i,r.RECENTS,!0,!1),this.recentsCount=10,this.recentsCount=t.recentsCount}wouldBeRendered(){return!0}shouldRender(e,t){return e.mtime!==t.mtime&&this.sortedFiles.first()!==t.file}getEmptyMessage(){return"No recents"}getTextIcon(){return"history"}getTitleText(){return"Recents"}getPillText(){return`Last ${this.recentsCount}`}getPillTooltipText(){return"Change number of recents"}getPillIcon(){return""}getTitleTooltip(){return`Shows last ${this.recentsCount} recently modified files`}getPillClickHandler(){return t=>{const i=new e.Menu;Y.forEach((e=>{i.addItem((t=>{t.setTitle(e.toString()),t.onClick((()=>(this.recentsCount=e,this.requestRender(),this.settings.recentsCount=e,this.callbacks.saveSettingsCallback()))),t.setIcon(this.recentsCount===e?"check":""),t.iconEl.addClass("oblogger-pill-menu-icon")}))})),i.showAtMouseEvent(t),i.dom.addClass("oblogger-pill-menu")}}buildFileStructure(e){let t=0;this.app.vault.getFiles().sort(((e,t)=>t.stat.mtime-e.stat.mtime)).forEach((i=>{t>=this.recentsCount||this.isFileExcluded(i,e)||(this.addFileToFolder(i,"","/"),t+=1)}))}}class H extends ${constructor(e,t,i){super(e,t,i,r.UNTAGGED,!1,!1)}wouldBeRendered(e){return 0===e.tags.length}shouldRender(e,t){return this.shouldRenderBasedOnSortMethodSetting(e,t)}getEmptyMessage(){return"No untagged documents"}getTextIcon(){return"alert-circle"}getTitleText(){return"Untagged"}getPillText(){var e,t;return a(null!==(t=null===(e=this.getGroupSettings())||void 0===e?void 0:e.sortMethod)&&void 0!==t?t:i)}getPillTooltipText(){return"Sort"}getPillIcon(){var e;return(null===(e=this.getGroupSettings())||void 0===e?void 0:e.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail"}getTitleTooltip(){return"Shows untagged notes"}getPillClickHandler(){return t=>{const n=new e.Menu;this.addSortOptionsToMenu(n,[i,s,o]),n.showAtMouseEvent(t)}}addFileToFolder(e,t,i){this.renderedFiles.push({file:e,mtime:e.stat.mtime,ctime:e.stat.ctime}),super.addFileToFolder(e,t,i)}buildAlphabeticalFileStructure(t,i){t.sort(((e,t)=>{const s=this.sortFilesByBookmark(e,t);return 0!=s?s:(i?1:-1)*this.sortFilesByName(e,t)})).forEach((t=>{var i,s;const o=this.app.metadataCache.getFileCache(t);null!==o&&0===(null!==(s=null===(i=e.getAllTags(o))||void 0===i?void 0:i.length)&&void 0!==s?s:-1)&&this.addFileToFolder(t,"","/")}))}buildFileStructure(t){var n,l,a,r,d,c,u;this.renderedFiles=[];const h=this.app.vault.getFiles().filter((i=>{var s,o;if("md"!==i.extension)return!1;if(this.isFileExcluded(i,t))return!1;const n=this.app.metadataCache.getFileCache(i);return null!==n&&(null!==(o=null===(s=e.getAllTags(n))||void 0===s?void 0:s.length)&&void 0!==o?o:1)<=0}));switch(null===(n=this.getGroupSettings())||void 0===n?void 0:n.sortMethod){case i:this.buildAlphabeticalFileStructure(h,null===(a=null===(l=this.getGroupSettings())||void 0===l?void 0:l.sortAscending)||void 0===a||a);break;case s:this.buildDateFileStructure(h,null===(d=null===(r=this.getGroupSettings())||void 0===r?void 0:r.sortAscending)||void 0===d||d,!0);break;case o:this.buildDateFileStructure(h,null===(u=null===(c=this.getGroupSettings())||void 0===c?void 0:c.sortAscending)||void 0===u||u,!1)}}}class j extends ${constructor(e,t,i){i.getGroupIconCallback=e=>e?"package":"package-open",super(e,t,i,r.FILES,!1,!0)}wouldBeRendered(e){return"md"!==e.extension}shouldRender(e,t){return this.shouldRenderBasedOnSortMethodSetting(e,t)}getEmptyMessage(){return"No special files"}getPillTooltipText(){return"Sort"}getPillIcon(){var e;return(null===(e=this.getGroupSettings())||void 0===e?void 0:e.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail"}getTextIcon(){return"package-2"}getTitleText(){return"Files"}getTitleTooltip(){return"Shows file types excluding markdown"}getPillText(){var e,t;return a(null!==(t=null===(e=this.getGroupSettings())||void 0===e?void 0:e.sortMethod)&&void 0!==t?t:i)}getPillClickHandler(){return t=>{const a=new e.Menu;this.addSortOptionsToMenu(a,[i,s,o,n,l]),a.showAtMouseEvent(t)}}buildAlphabeticalFileStructure(e,t){e.sort(((e,i)=>{const s=this.sortFilesByBookmark(e,i);return 0!=s?s:(t?1:-1)*this.sortFilesByName(e,i)})).forEach((e=>{this.addFileToFolder(e,"","/")}))}buildExtensionFileStructure(e,t){e.sort(((e,i)=>{if(e.extension!=i.extension)return(t?1:-1)*(e.extension<i.extension?-1:1);const s=this.sortFilesByBookmark(e,i);return 0!=s?s:this.sortFilesByName(e,i)})).forEach((e=>{this.addFileToFolder(e,e.extension,"/")}))}buildTypeFileStructure(e,t){e.sort(((e,i)=>{var s,o;const n=null!==(s=D(e.extension))&&void 0!==s?s:"unknown",l=null!==(o=D(i.extension))&&void 0!==o?o:"unknown";if(n!=l)return(t?1:-1)*(n<l?-1:1);const a=this.sortFilesByBookmark(e,i);return 0!=a?a:this.sortFilesByName(e,i)})).forEach((e=>{var t;this.addFileToFolder(e,null!==(t=D(e.extension))&&void 0!==t?t:"unknown","/")}))}buildFileStructure(e){var t,a,r,d;const c=this.app.vault.getFiles().filter((t=>!this.isFileExcluded(t,e)&&"md"!==t.extension)),u=null===(a=null===(t=this.getGroupSettings())||void 0===t?void 0:t.sortAscending)||void 0===a||a;switch(null!==(d=null===(r=this.getGroupSettings())||void 0===r?void 0:r.sortMethod)&&void 0!==d?d:n){case i:this.buildAlphabeticalFileStructure(c,u);break;case s:this.buildDateFileStructure(c,u,!0);break;case o:this.buildDateFileStructure(c,u,!1);break;case l:this.buildExtensionFileStructure(c,u);break;default:this.buildTypeFileStructure(c,u)}}}const _=new Set(["png","jpg","jpeg","gif"]);class z extends e.SuggestModal{constructor(t,i){super(t),this.onSelect=i,this.setPlaceholder("Type an image name"),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to dismiss"}]),this.allImages=this.app.vault.getAllLoadedFiles().filter((t=>t instanceof e.TFile&&_.has(t.extension)))}getSuggestions(t){const i=e.prepareFuzzySearch(t.trim());return this.allImages.filter((e=>i(e.name)))}renderSuggestion(e,t){t.createEl("div",{text:e.name}),t.ariaLabel=e.path}onChooseSuggestion(e){this.onSelect(e)}}function W(e,t){const i=document.createElement("div");i.addClass("separator-container"),i.addClass(e);const s=document.createElement("div");return s.addClass("separator"),s.ariaLabel=t,i.appendChild(s),i}class X extends V{constructor(e,t,i,s,o){super(e,t,i,c.PROPERTY_GROUP,s,o,!1)}getPillClickHandler(){return t=>{const s=new e.Menu;this.addSortOptionsToMenu(s,[i]),s.showAtMouseEvent(t)}}getAllValues(e,t){var i;switch(t){case"tags":case"multitext":return Array.isArray(e)?e.map((e=>e.trim())):e.split(",").map((e=>e.trim()));case"checkbox":return[e?"checked":"unchecked"];case"datetime":{const t=new Date(e);return[`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}, ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`]}default:return[(null!==(i=e.toString())&&void 0!==i?i:"").trim()]}}buildFileStructure(e){var t,s,o,n,l;const a=this.app.vault.getMarkdownFiles().filter((t=>!this.isFileExcluded(t,e))).map((e=>{var t;const i=null===(t=this.app.metadataCache.getFileCache(e))||void 0===t?void 0:t.frontmatter;return{file:e,value:i?i[this.groupName]:null}})).filter((e=>null!==e.value&&void 0!==e.value)),r=null===(t=this.app.metadataCache.getAllPropertyInfos()[this.groupName])||void 0===t?void 0:t.type,d=a.reduce(((e,t)=>(this.getAllValues(t.value,r).forEach((i=>{Object.keys(e).contains(i)||(e[i.toString().trim()]=[]),e[i.toString().trim()].push(t.file)})),e)),{}),c=null===(o=null===(s=this.getGroupSettings())||void 0===s?void 0:s.sortAscending)||void 0===o||o,u=c?1:-1,h=null!==(l=null===(n=this.getGroupSettings())||void 0===n?void 0:n.sortMethod)&&void 0!==l?l:i,p=this.getFileSortingFn(h);Object.entries(d).sort((([e],[t])=>u*(e<t?-1:e>t?1:0))).forEach((([e,t])=>{0!==t.length&&t.sort(((e,t)=>{const i=this.sortFilesByBookmark(e,t);return 0!=i?i:(c?1:-1)*p(e,t)})).forEach((t=>{this.addFileToFolder(t,e,"/")}))}))}getTextIcon(){return"text"}getTextIconTooltip(){return""}getTitleText(){return this.groupName}getTitleTooltip(){return"Property group"}wouldBeRendered(e){var t,i;return!!(null===(t=e.maybeMetadata)||void 0===t?void 0:t.frontmatter)&&Object.keys(null===(i=e.maybeMetadata)||void 0===i?void 0:i.frontmatter).contains(this.groupName)}}class K extends e.FuzzySuggestModal{constructor(e,t,i){super(e),this.excludedProperties=t,this.onSelect=i}getItems(){return Object.keys(this.app.metadataCache.getAllPropertyInfos()).filter((e=>!this.excludedProperties.contains(e))).sort()}getItemText(e){return e}onChooseItem(t,i){new e.Notice(`Selected ${t}`),this.onSelect(t)}}class J extends V{constructor(e,t,i,s,o){super(e,t,i,c.FOLDER_GROUP,s,o,!1),this.basePath=s}addAllFilesIn(t,i,s,o){const n="/"===this.basePath?0:this.basePath.length+1,l="/"===t.path?"":t.path.slice(n),a=t.children.filter((t=>t instanceof e.TFolder)).map((e=>e));t.children.filter((t=>t instanceof e.TFile&&!this.isFileExcluded(t,i))).map((e=>e)).sort(((e,t)=>{const i=this.sortFilesByBookmark(e,t);return 0!=i?i:(s?1:-1)*o(e,t)})).forEach((e=>{this.addFileToFolder(e,l,"")})),a.forEach((e=>{this.addAllFilesIn(e,i,s,o)}))}buildFileStructure(t){var s,o,n,l;const a=this.app.vault.getAbstractFileByPath(this.basePath);if(!(a instanceof e.TFolder))return void console.warn(`Unable to build container for ${this.basePath}. It is not a folder.`);const r=null===(o=null===(s=this.getGroupSettings())||void 0===s?void 0:s.sortAscending)||void 0===o||o,d=null!==(l=null===(n=this.getGroupSettings())||void 0===n?void 0:n.sortMethod)&&void 0!==l?l:i,c=this.getFileSortingFn(d);this.addAllFilesIn(a,t,r,c)}getPillClickHandler(){return t=>{const s=new e.Menu;this.addSortOptionsToMenu(s,[i]),s.showAtMouseEvent(t)}}getTextIcon(e){return e?"folder-closed":"folder-open"}getTextIconTooltip(){return""}getTitleText(){var e;return"/"===this.basePath?this.app.vault.getName():null!==(e=this.basePath.split("/").last())&&void 0!==e?e:this.basePath}getTitleTooltip(){return this.basePath}wouldBeRendered(e){let t=e.file.parent;for(;t;){if(t.path===this.basePath)return!0;t=t.parent}return!1}}const Q="oblogger-view";class Z extends e.ItemView{constructor(i,s,o,n){var l;super(i),this.renderTimeout=null,console.assert(!Object.entries(r).map((e=>[e.first(),String(e.last())])).concat(Object.entries(c).map((e=>[e.first(),String(e.last())]))).some((e=>{var t;return(null===(t=e.first())||void 0===t?void 0:t.toLowerCase())!==e.last()}))),this.fullRender=!0,this.settings=o,this.showLoggerCallbackFn=s,this.saveSettingsCallback=n,this.lastOpenFile=null!==(l=this.app.workspace.getActiveFile())&&void 0!==l?l:void 0,this.registerEvent(this.app.metadataCache.on("changed",((e,t,i)=>{this.requestRender(N(this.app,e,i))}))),this.registerEvent(this.app.vault.on("create",(()=>{this.requestRender()}))),this.registerEvent(this.app.vault.on("rename",(()=>{this.requestRender()}))),this.registerEvent(this.app.vault.on("delete",(()=>{this.requestRender()}))),this.registerEvent(this.app.workspace.on("file-open",(e=>{e&&(this.lastOpenFile=e,this.highlightLastOpenFile())}))),this.fileClickCallback=(e,t)=>this.app.workspace.getLeaf(t).openFile(e),this.fileAddedCallback=(i,s)=>{s.addEventListener("contextmenu",(s=>{const o=new e.Menu;o.addSeparator(),o.addItem((e=>e.setTitle("Open in new tab").setSection("open").setIcon("lucide-file-plus").onClick((()=>t(this,void 0,void 0,(function*(){return app.workspace.openLinkText(i.path,i.path,"tab")})))))),o.addItem((e=>e.setTitle("Open to the right").setSection("open").setIcon("lucide-separator-vertical").onClick((()=>t(this,void 0,void 0,(function*(){return app.workspace.openLinkText(i.path,i.path,"split")})))))),this.app.workspace.trigger("file-menu",o,i,"file-explorer"),o.addItem((e=>{e.setTitle("Delete").setSection("danger").setIcon("trash").onClick((()=>t(this,void 0,void 0,(function*(){this.app.fileManager.promptForDeletion(i)})))),e.dom.addClass("is-warning")})),o.addItem((e=>e.setTitle("Rename...").setSection("action").setIcon("pencil").onClick((()=>t(this,void 0,void 0,(function*(){this.app.fileManager.promptForFileRename(i)})))))),"screenX"in s?o.showAtPosition({x:s.pageX,y:s.pageY}):o.showAtPosition({x:s.nativeEvent.locationX,y:s.nativeEvent.locationY})}))},this.app.workspace.onLayoutReady((()=>{const e=this.app.internalPlugins.getEnabledPluginById("bookmarks");e&&e.on("changed",(()=>{this.requestRender()}))}))}highlightLastOpenFile(){var e;null===(e=this.rxContainers)||void 0===e||e.concat(this.otcContainers).forEach((e=>{this.lastOpenFile&&e.highlightFile(this.lastOpenFile)}))}getViewType(){return Q}getDisplayText(){return"Oblogger"}getIcon(){return"orbit"}requestRender(e){if(e){const t=this.filesModifiedSinceRender.findIndex((t=>t.file===e.file));t>=0?this.filesModifiedSinceRender[t]=e:this.filesModifiedSinceRender.push(e)}else this.fullRender=!0;this.renderTimeout||(this.renderTimeout=window.setTimeout((()=>{const e=this.fullRender?[]:this.filesModifiedSinceRender;return this.filesModifiedSinceRender=[],this.fullRender=!1,this.renderNow(e)}),100),this.registerInterval(this.renderTimeout))}renderContainers(e,t){e.forEach((e=>this.renderContainer(e,t)))}renderContainer(e,t){const i=y(this.settings,e.groupType,e.groupName);i?e.render(t,!1,i):console.warn(`Unable to find settings for container of type \n                ${e.groupType} with name ${e.groupName}`)}renderNow(e){return t(this,void 0,void 0,(function*(){yield this.renderAvatar(),yield this.renderVault(),this.renderClock(this.clockDiv),this.renderRXSeparator(),this.renderOTCSeparator(),this.refreshCollapseAllButton(),this.renderContainers(this.rxContainers,e),this.renderContainers(this.otcContainers,e),this.highlightLastOpenFile(),this.renderTimeout=null}))}renderAvatar(){var i,s,o,n,l,a;return t(this,void 0,void 0,(function*(){(null===(i=this.settings)||void 0===i?void 0:i.avatarVisible)?(null===(s=this.greeterContainerDiv)||void 0===s||s.removeClass("hidden"),null===(o=this.greeterDiv)||void 0===o||o.removeClass("no-avatar")):(null===(n=this.greeterContainerDiv)||void 0===n||n.addClass("hidden"),null===(l=this.greeterDiv)||void 0===l||l.addClass("no-avatar"));const t=new Image;if(null===(a=this.settings)||void 0===a?void 0:a.avatarPath){const i=this.app.vault.getAbstractFileByPath(this.settings.avatarPath);i instanceof e.TFile&&(t.src=this.app.vault.getResourcePath(i))}""===t.src&&t.addClass("hidden"),t.addClass("greeter-title-avatar"),this.avatarDiv.empty(),this.avatarDiv.appendChild(t)}))}renderVault(){var e,i,s;return t(this,void 0,void 0,(function*(){(null===(e=this.settings)||void 0===e?void 0:e.vaultVisible)?null===(i=this.vaultNameDiv)||void 0===i||i.removeClass("hidden"):null===(s=this.vaultNameDiv)||void 0===s||s.addClass("hidden"),this.vaultNameDiv.setText(this.app.vault.getName()),this.vaultNameDiv.addClass("greeter-vault-name")}))}renderClock(t){var i,s,o;(null===(i=this.settings)||void 0===i?void 0:i.clockVisible)?null===(s=this.clockDiv)||void 0===s||s.removeClass("hidden"):null===(o=this.clockDiv)||void 0===o||o.addClass("hidden"),t.empty();const n=e.moment(),l=document.createElement("div");l.setText(n.format("YYYY-MM-DD")),l.addClass("date"),t.appendChild(l);const a=document.createElement("div");a.setText(n.format("HH:mm:ss")),a.addClass("time"),t.appendChild(a)}renderRXSeparator(){var e,t,i;(null===(e=this.settings)||void 0===e?void 0:e.rxSeparatorVisible)?null===(t=this.rxSeparatorDiv)||void 0===t||t.removeClass("hidden"):null===(i=this.rxSeparatorDiv)||void 0===i||i.addClass("hidden")}renderOTCSeparator(){var t,i,s;(null===(t=this.settings)||void 0===t?void 0:t.otcSeparatorVisible)&&e.Platform.isDesktop?null===(i=this.otcSeparatorDiv)||void 0===i||i.removeClass("hidden"):null===(s=this.otcSeparatorDiv)||void 0===s||s.addClass("hidden")}buildGreeter(){return t(this,void 0,void 0,(function*(){this.greeterDiv=document.createElement("div"),this.greeterDiv.classList.add("greeter");const i=document.createElement("div");i.classList.add("greeter-title"),this.greeterContainerDiv=document.createElement("div"),this.greeterContainerDiv.addClass("greeter-dot-container"),i.appendChild(this.greeterContainerDiv);const s=document.createElement("div");s.addClass("greeter-title-avatar-border"),this.greeterContainerDiv.appendChild(s),this.avatarDiv=document.createElement("div"),yield this.renderAvatar(),this.greeterContainerDiv.appendChild(this.avatarDiv);const o=document.createElement("div");e.setIcon(o,"orbit"),o.addClass("greeter-title-default-avatar"),this.greeterContainerDiv.appendChild(o);const n=document.createElement("div");n.addClass("greeter-title-avatar-changer"),n.addEventListener("click",(()=>{new z(this.app,(i=>t(this,void 0,void 0,(function*(){this.settings.avatarPath=i.path,yield this.saveSettingsCallback(),new e.Notice(`Changed avatar image to ${i.path}`),this.requestRender()})))).open()}));const l=document.createElement("div");l.addClass("greeter-title-avatar-changer-label"),l.setText("Change"),n.appendChild(l),this.greeterContainerDiv.appendChild(n),this.greeterDiv.appendChild(i);const a=document.createElement("div");return a.classList.add("greeter-content"),this.greeterDiv.appendChild(a),this.vaultNameDiv=document.createElement("div"),yield this.renderVault(),a.appendChild(this.vaultNameDiv),this.clockDiv=document.createElement("div"),this.clockDiv.addClass("greeter-clock"),a.appendChild(this.clockDiv),this.renderClock(this.clockDiv),this.registerInterval(window.setInterval((()=>{this.renderClock(this.clockDiv)}),1e3)),this.greeterDiv}))}showNewPropertyModal(){const e=this.settings.otcGroups.filter((e=>e.groupType===c.PROPERTY_GROUP)).map((e=>e.groupName));new K(this.app,e,(e=>t(this,void 0,void 0,(function*(){this.settings.otcGroups||(this.settings.otcGroups=[]),this.settings.otcGroups.push({groupName:e,groupType:c.PROPERTY_GROUP,openFolders:[],isVisible:!0,isPinned:!1,sortMethod:i,sortAscending:!0,excludedFolders:[],logsFolderVisible:!0,templatesFolderVisible:!1}),yield this.saveSettingsCallback(),this.reloadOtcGroups()})))).open()}showNewTagModal(){const e=this.settings.otcGroups.filter((e=>e.groupType===c.TAG_GROUP)).map((e=>e.groupName));new B(this.app,e,(e=>t(this,void 0,void 0,(function*(){this.settings.otcGroups||(this.settings.otcGroups=[]),this.settings.otcGroups.push({groupName:e,groupType:c.TAG_GROUP,openFolders:[],isVisible:!0,isPinned:!1,sortMethod:i,sortAscending:!0,excludedFolders:[],logsFolderVisible:!1,templatesFolderVisible:!1}),yield this.saveSettingsCallback(),this.reloadOtcGroups()})))).open()}showNewFolderModal(){const e=this.settings.otcGroups.filter((e=>e.groupType===c.FOLDER_GROUP)).map((e=>e.groupName));new R(this.app,e,(e=>t(this,void 0,void 0,(function*(){this.settings.otcGroups||(this.settings.otcGroups=[]),this.settings.otcGroups.push({groupName:e,groupType:c.FOLDER_GROUP,openFolders:[],isVisible:!0,isPinned:!1,sortMethod:i,sortAscending:!0,excludedFolders:[],logsFolderVisible:!0,templatesFolderVisible:!0}),yield this.saveSettingsCallback(),this.reloadOtcGroups()})))).open()}refreshCollapseAllButton(){if(!this.collapseAllButton||!this.settings)return;const e=!this.settings.rxGroups.some((e=>{var t;return 0!==(null===(t=e.openFolders)||void 0===t?void 0:t.length)})),t=!this.settings.otcGroups.some((e=>{var t;return 0!==(null===(t=e.openFolders)||void 0===t?void 0:t.length)})),i=e&&t;this.collapseAllButton.setIcon(i?"chevrons-up-down":"chevrons-down-up"),this.collapseAllButton.setTooltip(i?"Expand all":"Collapse all")}toggleCollapseAll(){return t(this,void 0,void 0,(function*(){const e=this.settings.rxGroups.some((e=>{var t;return 0!==(null===(t=e.openFolders)||void 0===t?void 0:t.length)})),t=this.settings.otcGroups.some((e=>{var t;return 0!==(null===(t=e.openFolders)||void 0===t?void 0:t.length)}));e||t?(this.settings.rxGroups.forEach((e=>{e.openFolders=[]})),this.settings.otcGroups.forEach((e=>{e.openFolders=[]})),yield this.saveSettingsCallback(),this.reloadRxGroups(),this.reloadOtcGroups()):(this.rxContainers.forEach((e=>e.expandAll(!0))),this.otcContainers.forEach((e=>e.expandAll(!0))))}))}buildHeaderInto(i){const s=document.createElement("div");s.addClass("nav-buttons-container"),i.appendChild(s),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("edit").setTooltip("New note").onClick((()=>t(this,void 0,void 0,(function*(){var t,i;const s=this.app.fileManager.getNewFileParent(null!==(i=null===(t=this.app.workspace.getActiveFile())||void 0===t?void 0:t.path)&&void 0!==i?i:""),o=yield this.app.fileManager.createNewMarkdownFile(s);new e.Notice(`Created ${o.path}`),yield this.app.workspace.getLeaf(!1).openFile(o)})))),e.Platform.isDesktop&&new e.ButtonComponent(s).setClass("button-bar-button").setIcon("plus-square").setTooltip("Add new user group").onClick((t=>{const i=new e.Menu;i.addItem((e=>{e.setIcon("hash"),e.setTitle("Add tag group"),e.onClick((()=>this.showNewTagModal()))})),i.addItem((e=>{e.setIcon("text"),e.setTitle("Add property group"),e.onClick((()=>this.showNewPropertyModal()))})),i.addItem((e=>{e.setIcon("folder"),e.setTitle("Add folder group"),e.onClick((()=>this.showNewFolderModal()))})),i.showAtMouseEvent(t)})),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("form-input").setTooltip("Create a log entry").onClick(this.showLoggerCallbackFn),this.collapseAllButton=new e.ButtonComponent(s),this.collapseAllButton.setClass("button-bar-button").onClick((()=>t(this,void 0,void 0,(function*(){yield this.toggleCollapseAll(),this.refreshCollapseAllButton()})))),this.refreshCollapseAllButton(),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("gear").setTooltip("Settings").onClick((i=>{const s=new e.Menu;this.settings&&(s.addItem((i=>{i.setTitle((this.settings.avatarVisible?"Hide":"Show")+" avatar"),i.setIcon(this.settings.avatarVisible?"eye-off":"eye"),i.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.avatarVisible=!this.settings.avatarVisible,yield this.saveSettingsCallback(),this.requestRender()})))),s.addItem((e=>{e.setTitle((this.settings.vaultVisible?"Hide":"Show")+" vault name"),e.setIcon(this.settings.vaultVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.vaultVisible=!this.settings.vaultVisible,yield this.saveSettingsCallback(),this.requestRender()}))))})),s.addItem((e=>{e.setTitle((this.settings.clockVisible?"Hide":"Show")+" clock"),e.setIcon(this.settings.clockVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.clockVisible=!this.settings.clockVisible,yield this.saveSettingsCallback(),this.requestRender()}))))})),s.addItem((e=>{e.setTitle((this.settings.rxSeparatorVisible?"Hide":"Show")+" oblogger group separator"),e.setIcon(this.settings.rxSeparatorVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.rxSeparatorVisible=!this.settings.rxSeparatorVisible,yield this.saveSettingsCallback(),this.requestRender()}))))})),e.Platform.isDesktop&&s.addItem((e=>{e.setTitle((this.settings.otcSeparatorVisible?"Hide":"Show")+" user group separator"),e.setIcon(this.settings.otcSeparatorVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.otcSeparatorVisible=!this.settings.otcSeparatorVisible,yield this.saveSettingsCallback(),this.requestRender()}))))}))})),s.addSeparator(),this.settings.rxGroups.forEach((e=>{p(e.groupType)&&s.addItem((i=>{const s=e.isVisible;i.setTitle(`${s?"Hide":"Show"} ${e.groupType}`),i.setIcon(s?"eye-off":"eye"),i.onClick((()=>t(this,void 0,void 0,(function*(){e.isVisible=!e.isVisible,yield this.saveSettingsCallback(),this.requestRender()}))))}))})),s.showAtMouseEvent(i))}))}removeOtcGroup(i,s){var o;return t(this,void 0,void 0,(function*(){const t=this.otcContainers.filter((e=>e.groupType===i&&e.groupName===s)),n=t.first();void 0!==n?n.groupName===s?(this.otcContainers.remove(n),n.rootElement.remove(),this.settings.otcGroups=null===(o=this.settings)||void 0===o?void 0:o.otcGroups.filter((e=>e.groupName!==s||e.groupType!=i)),yield this.saveSettingsCallback(),this.requestRender(),new e.Notice(`"${s}" removed`)):console.debug("Something went wrong, container has the wrong name."):new e.Notice(`Unable to find group of type ${i} with name ${s}`)}))}moveRxGroup(e,i){return t(this,void 0,void 0,(function*(){if(!this.settings)return;const t=this.settings.rxGroups.findIndex((t=>t.groupType===e));if(-1===t)return void console.warn(`Rx group with type ${e} doesn't exist.`);let s=t+(i?-1:1);for(;s>0&&s<this.settings.rxGroups.length&&!this.settings.rxGroups[s].isVisible;)s+=i?-1:1;if(s<0||s>=this.settings.rxGroups.length)return void console.log("Already at "+(i?"top":"bottom"));const o=this.settings.rxGroups[t];this.settings.rxGroups.remove(o),this.settings.rxGroups.splice(s,0,o),yield this.saveSettingsCallback(),this.reloadRxGroups(),this.requestRender()}))}moveOtcGroup(e,i,s){var o;return t(this,void 0,void 0,(function*(){const t=this.settings.otcGroups,n=t.findIndex((t=>t.groupType===e&&t.groupName===i));if(-1===n)return void console.warn(`Group of type ${e} with name ${i} couldn't be found.`);let l=n+(s?-1:1);for(;l>0&&(null===(o=t.at(l))||void 0===o?void 0:o.groupType)!==e;)l+=s?-1:1;if(l<0||l>=t.length)return void console.log("Already at "+(s?"top":"bottom"));const a=t[n];t.remove(a),t.splice(l,0,a),yield this.saveSettingsCallback(),this.reloadOtcGroups(),this.requestRender()}))}pinOtcGroup(i,s,o){return t(this,void 0,void 0,(function*(){const t=y(this.settings,i,s);void 0!==t?(t.isPinned=o,yield this.saveSettingsCallback(),this.reloadOtcGroups(),this.requestRender()):new e.Notice(`Unable to find group type ${i} with name ${s} to ${o?"pin":"unpin"}`)}))}createOtcContainerFromSettingsGroup(e){const i={fileClickCallback:this.fileClickCallback,fileAddedCallback:this.fileAddedCallback,requestRenderCallback:()=>{this.requestRender()},saveSettingsCallback:this.saveSettingsCallback,getGroupIconCallback:e=>e?"folder-closed":"folder-open",hideCallback:()=>t(this,void 0,void 0,(function*(){return yield this.removeOtcGroup(e.groupType,e.groupName)})),moveCallback:t=>this.moveOtcGroup(e.groupType,e.groupName,t),pinCallback:t=>this.pinOtcGroup(e.groupType,e.groupName,t)};switch(e.groupType){case c.FOLDER_GROUP:return new J(this.app,this.settings,i,e.groupName,e.isPinned);case c.TAG_GROUP:return new O(this.app,e.groupName,this.settings,e.isPinned,i);case c.PROPERTY_GROUP:return new X(this.app,this.settings,i,e.groupName,e.isPinned);default:return console.warn(`Unexpected group type: ${e.groupType}`),null}}reloadOtcGroups(){var e,t,i,s;null===(e=this.otcContainers)||void 0===e||e.forEach((e=>e.rootElement.remove())),this.otcContainers=[],null===(t=this.otcGroupsDiv)||void 0===t||t.empty();const o=(e,t)=>{const i=g(e,this.app.vault.getName()),s=g(t,this.app.vault.getName());return i<s?-1:i>s?1:0},n=e=>{if(!this.otcGroupsDiv)return;if(!p(e.groupType))return;const t=this.createOtcContainerFromSettingsGroup(e);t&&(this.otcContainers.push(t),this.otcGroupsDiv.appendChild(t.rootElement),this.requestRender())};null===(i=this.settings)||void 0===i||i.otcGroups.filter((e=>e.isPinned)).sort(o).forEach(n),null===(s=this.settings)||void 0===s||s.otcGroups.filter((e=>!e.isPinned)).sort(o).forEach(n)}hideRxGroup(e){return t(this,void 0,void 0,(function*(){if(!d(e))return void console.warn(`Unknown rx group type: ${e}. Not hiding.`);const t=y(this.settings,e,"");t?(t.isVisible=!t.isVisible,yield this.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to find settings for group type ${e}`)}))}reloadRxGroups(){var e,t;if(!this.rxGroupsDiv)return;null===(e=this.rxContainers)||void 0===e||e.forEach((e=>e.rootElement.remove())),this.rxContainers=[];const i=e=>{if(!d(e))return void console.warn(`Unknown rx group type ${e}. Not creating.`);const t=(e=>{switch(e){case r.RECENTS:return U;case r.DAILIES:return q;case r.UNTAGGED:return H;case r.FILES:default:return j}})(e),i={fileClickCallback:this.fileClickCallback,fileAddedCallback:this.fileAddedCallback,requestRenderCallback:()=>{this.requestRender()},saveSettingsCallback:this.saveSettingsCallback,getGroupIconCallback:e=>e?"folder-closed":"folder-open",hideCallback:()=>this.hideRxGroup(e),moveCallback:t=>this.moveRxGroup(e,t),pinCallback:void 0};return new t(this.app,this.settings,i)};this.rxContainers=[],null===(t=this.settings)||void 0===t||t.rxGroups.forEach((e=>{const t=e.groupType;if(!p(t))return;const s=i(t);s&&this.rxContainers.push(s)})),this.rxGroupsDiv.empty(),this.rxContainers.forEach((e=>{var t;return null===(t=this.rxGroupsDiv)||void 0===t?void 0:t.appendChild(e.rootElement)}))}buildBodyInto(e){return t(this,void 0,void 0,(function*(){const t=yield this.buildGreeter();e.appendChild(t),this.rxSeparatorDiv=W("rx-separator","Built in groups"),e.appendChild(this.rxSeparatorDiv),this.rxGroupsDiv=document.createElement("div"),this.rxGroupsDiv.addClass("rx-groups"),this.reloadRxGroups(),e.appendChild(this.rxGroupsDiv),this.otcSeparatorDiv=W("otc-separator","User created tag groups"),e.appendChild(this.otcSeparatorDiv),this.otcGroupsDiv=document.createElement("div"),this.otcGroupsDiv.addClass("otc-groups"),this.reloadOtcGroups(),e.appendChild(this.otcGroupsDiv)}))}onOpen(){return t(this,void 0,void 0,(function*(){this.containerEl.empty();const e=document.createElement("div");e.addClass("oblogger-header"),this.buildHeaderInto(e),this.containerEl.appendChild(e);const t=document.createElement("div");t.addClass("oblogger-content"),yield this.buildBodyInto(t),this.containerEl.appendChild(t),this.requestRender()}))}}class ee extends e.AbstractInputSuggest{constructor(e,t,i,s){super(e,t),this.values=s.map((e=>`${e}`)),this.doSelection=i}getSuggestions(){const t=this.textInputEl.value,i=e.prepareFuzzySearch(t);return this.values.filter((e=>i(e))).sort(((e,i)=>e===t?-1:i==t?1:e<i?-1:e>i?1:0))}renderSuggestion(e,t){t.setText(e)}selectSuggestion(e){this.doSelection(e)}}const te=new Set(["time","day","date","type","cssclass","position"]);class ie extends e.Modal{constructor(e,t,i){super(e),this.settings=t,this.currentPostLogSelection=this.settings.postLogAction,this.logMap=this.gatherLogMap(),this.logFrontmatter={},this.logContent="",this.saveSettingsCallback=i,this.containerEl.addClass("logger")}gatherLogMap(){const t=new Map,i=this.app.vault.getAbstractFileByPath(this.settings.loggingPath);return i instanceof e.TFolder&&i.children.forEach((i=>{var s;i instanceof e.TFolder&&i.children?i.children.forEach((s=>{var o;s instanceof e.TFile&&t.set(i.name,(null!==(o=t.get(i.name))&&void 0!==o?o:[]).concat([s]))})):i instanceof e.TFile?t.set("",(null!==(s=t.get(""))&&void 0!==s?s:[]).concat([i])):console.error(`Unknown file type found in ${i}`)})),t}buildTitleBar(){const i=document.createElement("div");i.addClass("title-bar");const s=document.createElement("div");s.addClass("title-bar-label"),s.ariaLabel="Change logging path";const o=document.createElement("div");o.addClass("title-bar-icon"),e.setIcon(o,"save"),s.appendChild(o);const n=document.createElement("div");n.addClass("title-bar-label-text");const l=()=>{const t=e.normalizePath(this.settings.loggingPath),i=null==t?void 0:t.split("/").last();return void 0===i?"click here to set log path":t===i||"/"===t?t:`.../${i}`};n.setText(l()),s.appendChild(n),s.addEventListener("click",(()=>{new R(this.app,["/"],(i=>t(this,void 0,void 0,(function*(){this.settings.loggingPath=e.normalizePath(i),n.setText(l()),this.updateSubmitButtonIsDisabled(),yield this.saveSettingsCallback()})))).open()})),i.appendChild(s);const a=document.createElement("div");return a.addClass("logger-close-button"),e.setIcon(a,"x"),a.addEventListener("click",(()=>{this.close()})),i.appendChild(a),i}buildDateTimeDiv(){const t=document.createElement("div");t.addClass("datetime-section");const i=document.createElement("div");i.addClass("date-section");const s=document.createElement("div");new e.TextComponent(s).setValue(e.moment().format("YYYY-MM-DD")).onChange((e=>this.logFrontmatter.date=e)).setPlaceholder("date").onChanged(),i.appendChild(s),t.appendChild(i);const o=document.createElement("div");o.addClass("time-section");const n=document.createElement("div");return new e.TextComponent(n).onChange((e=>{this.logFrontmatter.time=e})).setValue(e.moment().format("HH:mm:ss")).setPlaceholder("time").onChanged(),o.appendChild(n),t.appendChild(o),t}buildTypeDiv(){const t=document.createElement("div");t.addClass("logger-section");const i=document.createElement("div");i.addClass("field-div"),this.typeInput=new e.TextComponent(i),this.typeInput.setPlaceholder("type");const s=Array.from(this.logMap.keys()).filter((e=>""!==e)),o=new ee(this.app,this.typeInput.inputEl,(e=>{var t,i;null===(t=this.typeInput)||void 0===t||t.setValue(e),null===(i=this.typeInput)||void 0===i||i.onChanged(),this.rebuildFieldsDiv(),o.close()}),s);return this.typeInput.inputEl.addEventListener("focusout",(()=>{var e;(null===(e=this.typeInput)||void 0===e?void 0:e.getValue())!==this.logFrontmatter.type&&this.rebuildFieldsDiv()})),t.appendChild(i),t}buildField(t,i,s,o){const n=document.createElement("div");n.addClass("logger-section"),n.setAttribute("field-key",t);const l=document.createElement("div");l.addClass("field-div");const a=new e.TextComponent(l);let r;if(a.setPlaceholder(t),t in this.logFrontmatter&&(a.setValue(this.logFrontmatter[t]),o[t]=this.logFrontmatter[t]),n.appendChild(l),s){const i=document.createElement("div");i.addClass("new-field-icons"),r=document.createElement("div"),r.addClass("warning-icon"),r.ariaLabel="New fields require content to be saved!",e.setIcon(r,"alert-triangle"),i.appendChild(r);const s=document.createElement("div");s.addClass("trash-icon"),e.setIcon(s,"x-circle"),s.ariaLabel="Remove new field",s.addEventListener("click",(()=>{var e;null===(e=this.fieldsDiv)||void 0===e||e.removeChild(n),delete this.logFrontmatter[t]})),i.appendChild(s),l.appendChild(i)}const d=new ee(this.app,a.inputEl,(e=>{a.setValue(e),a.onChanged(),d.close()}),Array.from(i));return a.onChange((e=>{s&&r&&r.toggleClass("hidden",!!e),this.logFrontmatter[t]=e})),{fieldDiv:n,fieldInput:a}}buildFieldsDiv(){var e,t,i;void 0===this.fieldsDiv&&(this.fieldsDiv=document.createElement("div"),this.fieldsDiv.addClass("additional-meta-group"));const s=null!==(t=null===(e=this.typeInput)||void 0===e?void 0:e.getValue())&&void 0!==t?t:"";this.logFrontmatter.type=s;const o=(null!==(i=this.logMap.get(s))&&void 0!==i?i:[]).reduce(((e,t)=>{var i,s;const o=null!==(s=null===(i=this.app.metadataCache.getFileCache(t))||void 0===i?void 0:i.frontmatter)&&void 0!==s?s:{};return Object.keys(o).forEach((t=>{var i;if(te.has(t))return;if(!o[t])return;const s=String(o[t]).trim();s&&e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:new Set).add(s))})),e}),new Map),n={};return["time","day","date","type"].forEach((e=>{e in this.logFrontmatter&&(n[e]=this.logFrontmatter[e])})),o.forEach(((e,t)=>{var i;if(te.has(t))return;const{fieldDiv:s}=this.buildField(t,e,!1,n);null===(i=this.fieldsDiv)||void 0===i||i.appendChild(s)})),this.logFrontmatter=n,this.fieldsDiv}rebuildFieldsDiv(){void 0!==this.fieldsDiv&&this.fieldsDiv.empty(),this.buildFieldsDiv(),this.updateSubmitButtonIsDisabled()}buildFrontmatter(){return`---\n${Object.keys(this.logFrontmatter).map((e=>`"${e}": "${this.logFrontmatter[e].trim()}"`)).concat(['"cssclass": "log-entry"']).join("\n")}\n---`}saveLog(){var i,s,o;return t(this,void 0,void 0,(function*(){const n=e.normalizePath(this.settings.loggingPath);this.app.vault.getAbstractFileByPath(n)||(yield this.app.vault.createFolder(n),new e.Notice(`Created logging folder at "${n}"`));const l=null!==(s=null===(i=this.typeInput)||void 0===i?void 0:i.getValue())&&void 0!==s?s:"";if(!l)return void new e.Notice("Unable to log without a type");const a=("/"===n?"":n+"/")+l;if(null===(null!==(o=this.app.vault.getAbstractFileByPath(a))&&void 0!==o?o:yield(()=>t(this,void 0,void 0,(function*(){return yield this.app.vault.createFolder(a),this.app.vault.getAbstractFileByPath(a)})))()))return void new e.Notice(`Something went wrong getting log folder "${a}"`);const r=`${this.buildFrontmatter()}\n\n${this.logContent}`,d=`${this.logFrontmatter.date}_${this.logFrontmatter.time.replaceAll(":",".")}`,c=`${a+"/"+`${""===l?"log":l}_${d}`}.md`;return this.app.vault.create(c,r)}))}submitLog(){var i;return t(this,void 0,void 0,(function*(){if(this.isSubmitButtonDisabled())return;if(!(null===(i=this.typeInput)||void 0===i?void 0:i.getValue()))return;const t=yield this.saveLog();if(void 0!==t){this.settings.postLogAction=this.currentPostLogSelection,yield this.saveSettingsCallback();const i=t.path.split(".").slice(0,-1).join(".");switch(new e.Notice(`Log file created at "${i}"`),this.currentPostLogSelection){case v:break;case m:yield this.app.workspace.getLeaf(!1).openFile(t);break;case C:yield navigator.clipboard.writeText(`[[${i}]]`);break;default:console.error(`Invalid selection: ${this.currentPostLogSelection}`)}}this.close()}))}isSubmitButtonDisabled(){var e,t;return null===(t=null===(e=this.logChoiceContainer)||void 0===e?void 0:e.hasClass("disabled"))||void 0===t||t}updateSubmitButtonIsDisabled(){var e,t,i,s,o;const n=""===(null!==(e=this.settings.loggingPath)&&void 0!==e?e:""),l=""===(null!==(i=null===(t=this.typeInput)||void 0===t?void 0:t.getValue())&&void 0!==i?i:""),a=n||l,r=a?n?"Requires logging path":l?"Requires type":"":"";this.submitButton&&(this.submitButton.ariaLabel=r),a?null===(s=this.logChoiceContainer)||void 0===s||s.addClass("disabled"):null===(o=this.logChoiceContainer)||void 0===o||o.removeClass("disabled")}buildSubmitBarDiv(){const i=document.createElement("div");i.addClass("submit-bar");const s=document.createElement("div");s.addClass("log-button-container"),this.logChoiceContainer=document.createElement("div"),this.logChoiceContainer.addClass("log-choice-container");const o=[[v,"Log quietly"],[m,"Log and open"],[C,"Log and copy"]];this.submitButton=document.createElement("div"),this.submitButton.addClass("log-choice"),this.updateSubmitButtonIsDisabled(),this.submitButton.addEventListener("click",(()=>t(this,void 0,void 0,(function*(){yield this.submitLog()})))),this.logChoiceContainer.appendChild(this.submitButton);const n=document.createElement("div"),l=document.createElement("div");l.addClass("log-chooser"),e.setIcon(l,"chevron-down"),document.addEventListener("click",(e=>{e.composedPath().includes(l)?n.hasClass("hidden")?(n.removeClass("hidden"),n.focus()):n.addClass("hidden"):e.composedPath().includes(n)||n.addClass("hidden")})),this.logChoiceContainer.appendChild(l),s.appendChild(this.logChoiceContainer),n.addClass("log-drop-down"),n.addClass("hidden");const a=new Map;o.forEach((e=>a.set(e[0],document.createElement("div"))));const r=()=>{var t;null===(t=this.submitButton)||void 0===t||t.setText((e=>{for(const t of o)if(t[0]===e)return t[1];return""})(this.currentPostLogSelection)),a.forEach(((t,i)=>{e.setIcon(t,i===this.currentPostLogSelection?"check":"")}))},d=document.createElement("div");return d.addClass("log-drop-down-choices"),o.forEach((e=>{const t=document.createElement("div");t.addClass("log-drop-container"),t.addEventListener("click",(()=>{this.currentPostLogSelection=e[0],n.addClass("hidden"),r()}));const i=document.createElement("div");i.addClass("log-drop-label"),i.setText(e[1]),t.appendChild(i);const s=a.get(e[0]);void 0!==s?(s.addClass("log-drop-icon"),t.appendChild(s),d.appendChild(t)):console.error(`undefined log drop icon for choice: ${e}`)})),n.appendChild(d),r(),s.appendChild(n),i.appendChild(s),i}buildNewFieldInputDiv(){const t=document.createElement("div");t.addClass("field-div");const i=new e.TextComponent(t).setPlaceholder("new label ...");i.inputEl.addClass("new-field-input");const s=()=>{var t,s,o;const n=i.inputEl.value;if(i.setValue(""),n){if(Array.from(null!==(s=null===(t=this.fieldsDiv)||void 0===t?void 0:t.children)&&void 0!==s?s:[]).some((e=>{var t;return(null===(t=e.getAttribute("field-key"))||void 0===t?void 0:t.toLowerCase())===n.toLowerCase()})))return void new e.Notice(`${n} already added`);if(te.has(n.toLowerCase()))return void new e.Notice(`${n} is special and you can't use it, sorry`);{const{fieldDiv:e,fieldInput:t}=this.buildField(n,new Set,!0,{});null===(o=this.fieldsDiv)||void 0===o||o.appendChild(e),t.inputEl.focus()}}},o=document.createElement("div");o.addClass("new-field-icons");const n=document.createElement("div");return n.addClass("add-icon"),n.ariaLabel="Add new field",e.setIcon(n,"plus-circle"),n.addEventListener("click",(()=>{i.setValue(""),i.inputEl.focus()})),o.appendChild(n),t.appendChild(o),i.inputEl.addEventListener("keypress",(e=>{"Enter"===e.key&&s()})),i.inputEl.addEventListener("focusout",(()=>{s()})),t}buildContentDiv(){const t=document.createElement("div");t.addClass("logger-section");const i=document.createElement("div");i.addClass("content-div");const s=new e.TextAreaComponent(i).onChange((e=>this.logContent=e));return s.setPlaceholder("content"),s.onChanged(),t.appendChild(i),t}buildContentSection(){const e=document.createElement("div");return e.addClass("content-section"),e.appendChild(W("metadata","These fields will write to frontmatter")),e.appendChild(this.buildDateTimeDiv()),e.appendChild(this.buildTypeDiv()),e.appendChild(this.buildFieldsDiv()),e.appendChild(this.buildNewFieldInputDiv()),e.appendChild(W("body","This field will write to the document body")),e.appendChild(this.buildContentDiv()),e}onOpen(){const e=document.createElement("div");e.addClass("accent-div");const t=document.createElement("div");t.addClass("accent-content"),t.appendChild(this.buildContentSection()),e.appendChild(this.buildTitleBar()),e.appendChild(t),e.appendChild(this.buildSubmitBarDiv()),this.contentEl.appendChild(e)}onClose(){this.contentEl.empty()}}class se extends e.Plugin{getObloggerView(){for(const e of this.app.workspace.getLeavesOfType(Q)){const t=e&&e.view;if(t instanceof Z)return t}}loadSettings(){var i,s,o;return t(this,void 0,void 0,(function*(){this.settings=Object.assign({},b,yield this.loadData());let t=!1;if(!((null!==(i=this.settings.version)&&void 0!==i?i:0)>7)){for(;(null!==(s=this.settings.version)&&void 0!==s?s:0)<7;){t=!0;const e=null!==(o=this.settings.version)&&void 0!==o?o:0;if(n=e,l=this.settings,Object.keys(f).contains(n.toString())?f[n](l):console.warn(`Unable to upgrade ${n}. No upgrade function defined.`),this.settings.version!=e+1)return void console.warn("Something went wrong upgrading settings.")}var n,l;return t?this.saveSettings():void 0}new e.Notice(`Settings for Oblogger are at ${this.settings.version} which is above the current version of 7. This will likely lead to some instability.`,0)}))}saveSettings(){var e;return t(this,void 0,void 0,(function*(){yield this.saveData(this.settings),null===(e=this.getObloggerView())||void 0===e||e.requestRender()}))}runLogger(){new ie(this.app,this.settings,(()=>this.saveSettings())).open()}onload(){return t(this,void 0,void 0,(function*(){yield this.loadSettings(),this.registerView(Q,(e=>new Z(e,(()=>t(this,void 0,void 0,(function*(){this.runLogger()}))),this.settings,(()=>t(this,void 0,void 0,(function*(){return yield this.saveSettings()})))))),this.addCommand({id:"open-oblogger-log-logger",name:"Oblogger Log Logger...",callback:()=>{this.runLogger()}}),this.addCommand({id:"open-oblogger-side-panel",name:"Open Oblogger...",callback:()=>{this.activateSidePane()}}),this.app.workspace.onLayoutReady((()=>{this.activateSidePane()}))}))}activateSidePane(){return t(this,void 0,void 0,(function*(){this.app.workspace.getActiveViewOfType(Z)||(this.app.workspace.detachLeavesOfType(Q),yield this.app.workspace.getLeftLeaf(!1).setViewState({type:Q,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(Q)[0]))}))}}module.exports=se;
